import Utils
import Config
from pypresence import Presence
from NetCode.Networking import UDPServer


DISCORD_APP_CLIENT_ID = "1349055429304520734"

pm = Utils.PopupManager()

# Initialize Discord RPC
if Utils.IsDiscordAppInstalled():
    try:
        RPC = Presence(DISCORD_APP_CLIENT_ID)
        RPC.connect()
        RPC.update(state="Running a Meme Mayhem Server")
        Utils.debug_log("DISCORD", "Discord RPC Connected and Presence Set")
    except Exception as e:
        Utils.error_log("DISCORD", f"Failed to initialize Discord RPC: {e}")

DEV_MODE = Config.DEV_MODE

def server_msg_parser(data: bytes) -> dict | None:
    """
    Function to parse server messages.
    TODO: Replace with actual message parsing logic.
    """
    try:
        return {'message': data.decode('utf-8')}  # Simple placeholder for message parsing
    except Exception as e:
        print(f"[MEME_MAYHEM/SERVER]: <SERVER_PARSER_FUNC_ERR> Parse error: {e}")
        return None

SERVER_HEADER: str = """
███████████████             █████████████          ██████████████             ███████████████       
███▓▓▓▓▓▓▓▓▓█████           ██▓▓▓▓▓▓▓▓▓█████       ██▓▓▓▓▓▓▓▓▓██████          ███▓▓▓▓▓▓▓▓██████     
███▓▓▓▓▓▓▓▓▓███████    ▓▓▓▓▓██▓▓▓▓▓▓▓▓▓███████     ██▓▓▓▓▓▓▓▓▓████████   ▓▓▓▓▓███▓▓▓▓▓▓▓▓████████   
███▓▓▓▓▓▓▓▓▓██████████████████▓▓▓▓▓▓▓▓▓█████████   ██▓▓▓▓▓▓▓▓▓█████████  ████████▓▓▓▓▓▓▓▓██████████ 
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓███████▓▓▓▓███████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓████████▓▓▓████████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓███████▓▓▓▓███████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓████████▓▓▓████████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓███████▓▓▓▓███████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓████████▓▓▓████████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓██████████████████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████████████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓██████████████████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████████████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓██████████████████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████████████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓██████████████████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████████████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓███████████ ██████▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████  ██████▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓███████████     ██▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████     ███▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓███████████     ██▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████     ███▓▓▓▓▓▓▓▓███████████
███▓▓▓▓▓▓▓▓▓███████████     ██▓▓▓▓▓▓▓▓▓██████████  ██▓▓▓▓▓▓▓▓▓███████████     ███▓▓▓▓▓▓▓▓███████████
███████████████████████     █████████████████████  ██████████████████████     ██████████████████████
 ██████████████████████     █████████████████████  ██████████████████████      █████████████████████
   ████████████████████      ████████████████████    ████████████████████        ███████████████████
    ███████████████████        ██████████████████      ██████████████████         ██████████████████
      █████████████████          ████████████████        ████████████████           ████████████████
         █████████████             ██████████████          █████████████              ██████████████
"""

RED = "\033[91m"
RESET = "\033[0m"

print(f"{RED}{SERVER_HEADER}{RESET}")

# NOTE: if you change this the game could get unstable
SERVER_MAX_PLAYERS = 15

print("[MEME_MAYHEM/SERVER]: <SERVER_INIT> ~ Initializing server...")

Server = UDPServer.UDPServer()